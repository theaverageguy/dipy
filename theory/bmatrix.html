<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Dipy &mdash; dipy 0.11.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/dipy.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.11.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="dipy 0.11.0 documentation" href="../index.html" />
  <meta name="keywords" content="dipy, dMRI, DTI, DSI, diffusion MRI, Tensor,
  neuroimaging, python, neuroscience, Eleftherios, Garyfallidis, tractography,
  streamlines, fiber tracking">

  </head>
  <body>
<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
 <a href="../index.html">
  <img src="../_static/dipy-banner.png" alt="dipy logo"  border="0" />
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
  <li><a href="../index.html">Home</a> |&nbsp;</li>
  <li><a href="../stateoftheart.html">Overview</a> |&nbsp;</li>
  <li><a href="../examples_index.html">Gallery</a> |&nbsp;</li>
  <li><a href="../installation.html">Download</a> |&nbsp;</li>
  <li><a href="../subscribe.html">Subscribe</a> |&nbsp;</li>
  <li><a href="../developers.html">Developers</a> |&nbsp;</li>
  <li><a href="../cite.html">Cite</a> &nbsp;</li>
 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">


<h4> Site Navigation </h4>
  <ul>
    <li><a href="../documentation.html">Documentation</a></li>
    <li><a href="../devel/index.html">Development</a></li>
  </ul>

<h4> NIPY Community </h4>
  <ul class="simple">
    <li><a class="reference external"
	href="http://nipy.org/">Community Home</a></li>
    <li><a class="reference external"
	href="http://nipy.org/software/projects/">NIPY Projects</a></li>
    <li><a class="reference external"
	href="https://mail.python.org/mailman/listinfo/neuroimaging">Mailing List</a></li>
    <li><a class="reference external"
	href="http://nipy.org/nipy/license.html">License</a></li>
  </ul>


  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/theory/bmatrix.txt"
           rel="nofollow">Show Source</a></li>
  </ul>

<div id="searchbox-ml" style="display: none">
  <h3>Search mailing list archive</h3>
  <script type="text/javascript">
    function mlsearch(curobj)
    {
    curobj.q.value="site:mail.python.org/pipermail/neuroimaging/ "+curobj.userquery.value
    }
  </script>
  <form action="http://www.google.com/search" method="get" onSubmit="mlsearch(this)">
    <input name="userquery" size="13" type="text" /> <input type="submit" value="Go" />
    <input name="q" type="hidden" />
  </form>
</div>

<div id="searchbox-site" style="display: none">
  <h3>Search this site</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="13" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    </p>
</div>
<script type="text/javascript">$('#searchbox-ml').show(0);</script>
<script type="text/javascript">$('#searchbox-site').show(0);</script>


<script>
     ((window.gitter = {}).chat = {}).options = {
       room: 'nipy/dipy'
     };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="the-b-matrix-and-siemens-dicom">
<h1>The B matrix and Siemens DICOM<a class="headerlink" href="#the-b-matrix-and-siemens-dicom" title="Permalink to this headline">¶</a></h1>
<p>This is a short note to explain the nature of the <tt class="docutils literal"><span class="pre">B_matrix</span></tt> found in the
Siemens private (CSA) fields of the DICOM headers of a diffusion weighted
acquisition.  We trying to explain the relationship between the <tt class="docutils literal"><span class="pre">B_matrix</span></tt> and
the <em>b value</em> and the <em>gradient vector</em>.  The acquisition is made with a planned
(requested) b value - say <img class="math" src="../_images/math/bbfcdf58b57a117124971e050f76b2d21adc4fe3.png" alt="b_{req} = 1000"/>, and with a requested gradient
direction <img class="math" src="../_images/math/d160557712681a358a646fe448ccc1f21ceeab7a.png" alt="\mathbf{g}_{req} = [g_x, g_y, g_z]"/> (supposedly a unit vector).</p>
<p>Note that here we&#8217;re using <img class="math" src="../_images/math/dd9f8e4fa6ad795780215243cbd5a5719b772ad3.png" alt="\mathbf{q}"/> in the sense of an approximation
to a vector in <img class="math" src="../_images/math/23f1b45408e5b4130c0f940fcbfcec54492cbdcd.png" alt="q"/> space.  Other people use <img class="math" src="../_images/math/dd6a0c79ee7e76c8e6f1310a5d171d5b3848b685.png" alt="\mathbf{b}"/> for the same
concept, but we&#8217;ve chosen <img class="math" src="../_images/math/dd9f8e4fa6ad795780215243cbd5a5719b772ad3.png" alt="\mathbf{q}"/> to make the exposition clearer.</p>
<p>For some purposes we want the q vector <img class="math" src="../_images/math/9204b766e87513e8b6c4ce8382b371313fd1d3bd.png" alt="\mathbf{q}_{actual}"/> which is
equal to <img class="math" src="../_images/math/54566a73adaa663d09c87ff6117cd4b857536651.png" alt="b_{actual} . \mathbf{g}_{actual}"/>. We need to be aware that
<img class="math" src="../_images/math/2fc19b6a7d99f2137d50a532fe9bc1a48f1364d1.png" alt="b_{actual}"/> and <img class="math" src="../_images/math/f403591003ae6162f7ffd9f44294517e9c0ce280.png" alt="\mathbf{g}_{actual}"/> may be different from the
<img class="math" src="../_images/math/161d023e8b95e9124545b1d893cbe0ad3e4f6558.png" alt="b_{req}"/> and <img class="math" src="../_images/math/ec17d611a088db700c8e1abe9ba8ef8f714143d3.png" alt="\mathbf{g}_{req}"/>!  Though the Stejskal and Tanner
formula is available for the classic PGSE sequence, a different sequence
may be used (e.g. TRSE on Siemens Trio), and anyway the ramps up and
down on the gradient field will not be rectangular. The Siemens scanner
software calculates the effective directional diffusion weighting of the
acquisition on the basis of the temporal profile of the applied gradient
vector field. These are in the form of the 6 <tt class="docutils literal"><span class="pre">B_matrix</span></tt> values
<img class="math" src="../_images/math/c579c87770f42fc5f6912bf7c2dcc22622d0c0e5.png" alt="[b_{xx}, b_{xy}, b_{xz}, b_{yy}, b_{yz}, b_{zz}]"/>.</p>
<p>In this form they are suitable for use in a least squares estimation of
the diffusion tensor via the equations across the set of acquisitions:</p>
<div class="math">
<p><img src="../_images/math/a91e14b8340a8f4280d1145e4b58bfcfc92cd23a.png" alt="\log(A(\mathbf{q})/A(0)) = -(b_{xx}D_{xx} + 2b_{xy}D_{xy} + 2b_{xz}D_{xz} + \
   b_{yy}D_{yy} + 2b_{yz}D_{yz} + b_{zz}D_{zz})"/></p>
</div><p>The gradient field typically stays in the one gradient direction, in
this case the relationship between <img class="math" src="../_images/math/dd9f8e4fa6ad795780215243cbd5a5719b772ad3.png" alt="\mathbf{q}"/> and the <img class="math" src="../_images/math/c0ed827e5788f08b1d6eefce8acb2681c74c38ae.png" alt="b_{ij}"/> is as
follows. If we fill out the symmetric B-matrix as:</p>
<div class="math">
<p><img src="../_images/math/c9140a26c84a0b4fb538da84f4729ebde2e38696.png" alt="\mathbf{B} = \begin{pmatrix}
              b_{xx} &amp; b_{yx} &amp; b_{yz}\\
              b_{xy} &amp; b_{yy} &amp; b_{xz}\\
              b_{xz} &amp; b_{yz} &amp; b_{zz}
              \end{pmatrix}"/></p>
</div><p>then <img class="math" src="../_images/math/fb542518f2c3338d27234e14932fd1ab5a311d8b.png" alt="\mathbf{B}"/> is equal to the rank 1 tensor
<img class="math" src="../_images/math/811fbdc103331219c4e58e4259c0dc1f284e18db.png" alt="b\mathbf{g}\mathbf{g}^T"/>. One of the ways to recover <img class="math" src="../_images/math/5e87bf41a96deddf6cb485ff530f153f2590e9cc.png" alt="b"/> and <img class="math" src="../_images/math/44cfef0a87943444f7d88fe77a9df36ba6986b11.png" alt="\mathbf{g}"/>,
and hence <img class="math" src="../_images/math/dd9f8e4fa6ad795780215243cbd5a5719b772ad3.png" alt="\mathbf{q}"/>, from
<img class="math" src="../_images/math/fb542518f2c3338d27234e14932fd1ab5a311d8b.png" alt="\mathbf{B}"/> is to do a singular value decomposition of <img class="math" src="../_images/math/60e210aeda32f164be9f29953b77694aba604cbb.png" alt="\mathbf{B}:
\mathbf{B} = \lambda_1\mathbf{v}_1\mathbf{v}_1^T +
\lambda_2\mathbf{v}_2\mathbf{v}_2^T +
\lambda_3\mathbf{v}_3\mathbf{v}_3^T"/>, where only one of the <img class="math" src="../_images/math/3b765ea6939f1eba2541e91f870cb3c078aa29be.png" alt="\lambda_i"/>,
say <img class="math" src="../_images/math/18cbd415b1a8e3f19977c5d04d046d41c585c7de.png" alt="\lambda_1"/>, is effectively non-zero. Then <img class="math" src="../_images/math/0db17b75290206eff39357baa75eb28f8624b4f7.png" alt="b = \lambda_1"/>, <img class="math" src="../_images/math/702e1bb574297c4b178e6d135d40deee9fc11e84.png" alt="\mathbf{g} =
\pm\mathbf{v}_1,"/> and <img class="math" src="../_images/math/ea51a04036cd5bc09ab114551d83e3b1e677ddf6.png" alt="\mathbf{q} =
\pm\lambda_1\mathbf{v}_1."/> The choice of sign is arbitrary
(essentially we have a choice between two possible square roots of the
rank 1 tensor <img class="math" src="../_images/math/fb542518f2c3338d27234e14932fd1ab5a311d8b.png" alt="\mathbf{B}"/>). Once we have <img class="math" src="../_images/math/9204b766e87513e8b6c4ce8382b371313fd1d3bd.png" alt="\mathbf{q}_{actual}"/> we can
calculate <img class="math" src="../_images/math/a1837c8f5553338135a84c8574e1bc71e24f1b4d.png" alt="b_{actual} = |\mathbf{q}_{actual}|"/> and <img class="math" src="../_images/math/544189f4dbd441fa8129e86faeae9a6eeb9fb674.png" alt="\mathbf{g}_{actual}
= \mathbf{q}_{actual} / b_{actual}"/>. Various sofware packages
(e.g. FSL&#8217;s DFT-DTIFIT) expect to get 3 × N and 1 × N arrays of
<img class="math" src="../_images/math/f403591003ae6162f7ffd9f44294517e9c0ce280.png" alt="\mathbf{g}_{actual}"/> and <img class="math" src="../_images/math/2fc19b6a7d99f2137d50a532fe9bc1a48f1364d1.png" alt="b_{actual}"/> values as their inputs.</p>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
  <li><a href="../index.html">Home</a> |&nbsp;</li>
  <li><a href="../stateoftheart.html">Overview</a> |&nbsp;</li>
  <li><a href="../examples_index.html">Gallery</a> |&nbsp;</li>
  <li><a href="../installation.html">Download</a> |&nbsp;</li>
  <li><a href="../subscribe.html">Subscribe</a> |&nbsp;</li>
  <li><a href="../developers.html">Developers</a> |&nbsp;</li>
  <li><a href="../cite.html">Cite</a> &nbsp;</li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2008-2015, dipy developers &lt;neuroimaging@python.org&gt;.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>