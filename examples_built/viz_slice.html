<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Dipy &mdash; dipy 0.11.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/dipy.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.11.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="dipy 0.11.0 documentation" href="../index.html" />
  <meta name="keywords" content="dipy, dMRI, DTI, DSI, diffusion MRI, Tensor,
  neuroimaging, python, neuroscience, Eleftherios, Garyfallidis, tractography,
  streamlines, fiber tracking">

  </head>
  <body>
<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
 <a href="../index.html">
  <img src="../_static/dipy-banner.png" alt="dipy logo"  border="0" />
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
  <li><a href="../index.html">Home</a> |&nbsp;</li>
  <li><a href="../stateoftheart.html">Overview</a> |&nbsp;</li>
  <li><a href="../examples_index.html">Gallery</a> |&nbsp;</li>
  <li><a href="../installation.html">Download</a> |&nbsp;</li>
  <li><a href="../subscribe.html">Subscribe</a> |&nbsp;</li>
  <li><a href="../developers.html">Developers</a> |&nbsp;</li>
  <li><a href="../cite.html">Cite</a> &nbsp;</li>
 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">


<h4> Site Navigation </h4>
  <ul>
    <li><a href="../documentation.html">Documentation</a></li>
    <li><a href="../devel/index.html">Development</a></li>
  </ul>

<h4> NIPY Community </h4>
  <ul class="simple">
    <li><a class="reference external"
	href="http://nipy.org/">Community Home</a></li>
    <li><a class="reference external"
	href="http://nipy.org/software/projects/">NIPY Projects</a></li>
    <li><a class="reference external"
	href="https://mail.python.org/mailman/listinfo/neuroimaging">Mailing List</a></li>
    <li><a class="reference external"
	href="http://nipy.org/nipy/license.html">License</a></li>
  </ul>


  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Simple volume slicing</a><ul>
<li><a class="reference internal" href="#render-slices-from-t1-with-a-specific-value-range">Render slices from T1 with a specific value range</a></li>
<li><a class="reference internal" href="#render-slices-from-fa-with-your-colormap">Render slices from FA with your colormap</a></li>
<li><a class="reference internal" href="#create-a-mosaic">Create a mosaic</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/examples_built/viz_slice.txt"
           rel="nofollow">Show Source</a></li>
  </ul>

<div id="searchbox-ml" style="display: none">
  <h3>Search mailing list archive</h3>
  <script type="text/javascript">
    function mlsearch(curobj)
    {
    curobj.q.value="site:mail.python.org/pipermail/neuroimaging/ "+curobj.userquery.value
    }
  </script>
  <form action="http://www.google.com/search" method="get" onSubmit="mlsearch(this)">
    <input name="userquery" size="13" type="text" /> <input type="submit" value="Go" />
    <input name="q" type="hidden" />
  </form>
</div>

<div id="searchbox-site" style="display: none">
  <h3>Search this site</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="13" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    </p>
</div>
<script type="text/javascript">$('#searchbox-ml').show(0);</script>
<script type="text/javascript">$('#searchbox-site').show(0);</script>


<script>
     ((window.gitter = {}).chat = {}).options = {
       room: 'nipy/dipy'
     };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="simple-volume-slicing">
<span id="example-viz-slice"></span><h1>Simple volume slicing<a class="headerlink" href="#simple-volume-slicing" title="Permalink to this headline">¶</a></h1>
<p>Here we present an example for visualizing slices from 3D images.</p>
<dl class="docutils">
<dt>::</dt>
<dd><p class="first">from __future__ import division</p>
<p class="last">import os
import nibabel as nib
from dipy.data import fetch_bundles_2_subjects
from dipy.viz import window, actor</p>
</dd>
</dl>
<p>Let&#8217;s download and load a T1.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fetch_bundles_2_subjects</span><span class="p">()</span>

<span class="n">fname_t1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s">&#39;~&#39;</span><span class="p">),</span> <span class="s">&#39;.dipy&#39;</span><span class="p">,</span>
                        <span class="s">&#39;exp_bundles_and_maps&#39;</span><span class="p">,</span> <span class="s">&#39;bundles_2_subjects&#39;</span><span class="p">,</span>
                        <span class="s">&#39;subj_1&#39;</span><span class="p">,</span> <span class="s">&#39;t1_warped.nii.gz&#39;</span><span class="p">)</span>


<span class="n">img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fname_t1</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
<span class="n">affine</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get_affine</span><span class="p">()</span>
</pre></div>
</div>
<p>Create a Renderer object which holds all the actors which we want to visualize.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">renderer</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">Renderer</span><span class="p">()</span>
<span class="n">renderer</span><span class="o">.</span><span class="n">background</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<div class="section" id="render-slices-from-t1-with-a-specific-value-range">
<h2>Render slices from T1 with a specific value range<a class="headerlink" href="#render-slices-from-t1-with-a-specific-value-range" title="Permalink to this headline">¶</a></h2>
<p>The T1 has usually a higher range of values than what can be visualized in an
image. We can set the range that we would like to see.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">mean</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">value_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">std</span><span class="p">,</span> <span class="n">mean</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">std</span><span class="p">)</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">slice</span></tt> function will read data and resample the data using an affine
transformation matrix. The default behavior of this function is to show the
middle slice of the last dimension of the resampled data.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">slice_actor</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">slicer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">affine</span><span class="p">,</span> <span class="n">value_range</span><span class="p">)</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">slice_actor</span></tt> contains an axial slice.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">renderer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">slice_actor</span><span class="p">)</span>
</pre></div>
</div>
<p>The same actor can show any different slice from the given data using its
<tt class="docutils literal"><span class="pre">display</span></tt> function. However, if we want to show multiple slices we need to
copy the actor first.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">slice_actor2</span> <span class="o">=</span> <span class="n">slice_actor</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
<p>Now we have a new <tt class="docutils literal"><span class="pre">slice_actor</span></tt> which displays the middle slice of sagittal
plane.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">slice_actor2</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">slice_actor2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

<span class="n">renderer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">slice_actor2</span><span class="p">)</span>

<span class="n">renderer</span><span class="o">.</span><span class="n">reset_camera</span><span class="p">()</span>
<span class="n">renderer</span><span class="o">.</span><span class="n">zoom</span><span class="p">(</span><span class="mf">1.4</span><span class="p">)</span>
</pre></div>
</div>
<p>In order to interact with the data you will need to uncomment the line below.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># window.show(renderer, size=(600, 600), reset_camera=False)</span>
</pre></div>
</div>
<p>Otherwise, you can save a screenshot using the following command.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s">&#39;slices.png&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">),</span>
              <span class="n">reset_camera</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="../_images/slices.png" src="../_images/slices.png" />
<p class="caption"><strong>Simple slice viewer</strong>.</p>
</div>
</div>
<div class="section" id="render-slices-from-fa-with-your-colormap">
<h2>Render slices from FA with your colormap<a class="headerlink" href="#render-slices-from-fa-with-your-colormap" title="Permalink to this headline">¶</a></h2>
<p>It is also possible to set the colormap of your preference. Here we are loading
an FA image and showing it in a non-standard way using an HSV colormap.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fname_fa</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s">&#39;~&#39;</span><span class="p">),</span> <span class="s">&#39;.dipy&#39;</span><span class="p">,</span>
                        <span class="s">&#39;exp_bundles_and_maps&#39;</span><span class="p">,</span> <span class="s">&#39;bundles_2_subjects&#39;</span><span class="p">,</span>
                        <span class="s">&#39;subj_1&#39;</span><span class="p">,</span> <span class="s">&#39;fa_1x1x1.nii.gz&#39;</span><span class="p">)</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fname_fa</span><span class="p">)</span>
<span class="n">fa</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
</pre></div>
</div>
<p>Notice here how the scale range is (0, 255) and not (0, 1) which is the usual
range of FA values.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">lut</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">colormap_lookup_table</span><span class="p">(</span><span class="n">scale_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
                                  <span class="n">hue_range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span>
                                  <span class="n">saturation_range</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span>
                                  <span class="n">value_range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">))</span>
</pre></div>
</div>
<p>This is because the lookup table is applied in the slice after interpolating
to (0, 255).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fa_actor</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">slicer</span><span class="p">(</span><span class="n">fa</span><span class="p">,</span> <span class="n">affine</span><span class="p">,</span> <span class="n">lookup_colormap</span><span class="o">=</span><span class="n">lut</span><span class="p">)</span>

<span class="n">renderer</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="n">renderer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fa_actor</span><span class="p">)</span>

<span class="n">renderer</span><span class="o">.</span><span class="n">reset_camera</span><span class="p">()</span>
<span class="n">renderer</span><span class="o">.</span><span class="n">zoom</span><span class="p">(</span><span class="mf">1.4</span><span class="p">)</span>

<span class="c"># window.show(renderer, size=(600, 600), reset_camera=False)</span>

<span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s">&#39;slices_lut.png&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">),</span>
              <span class="n">reset_camera</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="../_images/slices_lut.png" src="../_images/slices_lut.png" />
<p class="caption"><strong>Simple slice viewer with an HSV colormap</strong>.</p>
</div>
</div>
<div class="section" id="create-a-mosaic">
<h2>Create a mosaic<a class="headerlink" href="#create-a-mosaic" title="Permalink to this headline">¶</a></h2>
<p>By using the <tt class="docutils literal"><span class="pre">copy</span></tt> and <tt class="docutils literal"><span class="pre">display</span></tt> method of the <tt class="docutils literal"><span class="pre">slice_actor</span></tt> becomes
easy and efficient to create a mosaic of all the slices.</p>
<p>So, let&#8217;s clear the renderer and change the projection from perspective to
parallel.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">renderer</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="n">renderer</span><span class="o">.</span><span class="n">projection</span><span class="p">(</span><span class="s">&#39;parallel&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we need to create two nested for loops which will set the positions of
the grid of the mosaic and add the new actors to the renderer. We are going
to use 15 columns and 10 rows but you can adjust those with your datasets.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">slice_actor</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>

<span class="n">rows</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">cols</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">border</span> <span class="o">=</span> <span class="mi">10</span>

<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
        <span class="n">slice_mosaic</span> <span class="o">=</span> <span class="n">slice_actor</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">slice_mosaic</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">cnt</span><span class="p">)</span>
        <span class="n">slice_mosaic</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">((</span><span class="n">X</span> <span class="o">+</span> <span class="n">border</span><span class="p">)</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span>
                                 <span class="mf">0.5</span> <span class="o">*</span> <span class="n">cols</span> <span class="o">*</span> <span class="p">(</span><span class="n">Y</span> <span class="o">+</span> <span class="n">border</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">Y</span> <span class="o">+</span> <span class="n">border</span><span class="p">)</span> <span class="o">*</span> <span class="n">j</span><span class="p">,</span>
                                 <span class="mi">0</span><span class="p">)</span>
        <span class="n">renderer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">slice_mosaic</span><span class="p">)</span>
        <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">cnt</span> <span class="o">&gt;</span> <span class="n">Z</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="n">cnt</span> <span class="o">&gt;</span> <span class="n">Z</span><span class="p">:</span>
        <span class="k">break</span>

<span class="n">renderer</span><span class="o">.</span><span class="n">reset_camera</span><span class="p">()</span>
<span class="n">renderer</span><span class="o">.</span><span class="n">zoom</span><span class="p">(</span><span class="mf">1.6</span><span class="p">)</span>

<span class="c"># window.show(renderer, size=(900, 600), reset_camera=False)</span>
</pre></div>
</div>
<p>If you uncomment the <tt class="docutils literal"><span class="pre">window.show</span></tt> line above, you will be able to move the
mosaic up/down and left/right using the middle mouse button pressed. And zoom
in/out using the scroll wheel.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">window</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span> <span class="n">out_path</span><span class="o">=</span><span class="s">&#39;mosaic.png&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">900</span><span class="p">,</span> <span class="mi">600</span><span class="p">),</span>
              <span class="n">reset_camera</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="../_images/mosaic.png" src="../_images/mosaic.png" />
<p class="caption"><strong>A mosaic of all the slices in the T1 volume</strong>.</p>
</div>
<div class="admonition-example-source-code admonition">
<p class="first admonition-title">Example source code</p>
<p class="last">You can download <a class="reference download internal" href="../_downloads/viz_slice.py"><tt class="xref download docutils literal"><span class="pre">the</span> <span class="pre">full</span> <span class="pre">source</span> <span class="pre">code</span> <span class="pre">of</span> <span class="pre">this</span> <span class="pre">example</span></tt></a>.
This same script is also included in the dipy source distribution under the
<tt class="file docutils literal"><span class="pre">doc/examples/</span></tt> directory.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
  <li><a href="../index.html">Home</a> |&nbsp;</li>
  <li><a href="../stateoftheart.html">Overview</a> |&nbsp;</li>
  <li><a href="../examples_index.html">Gallery</a> |&nbsp;</li>
  <li><a href="../installation.html">Download</a> |&nbsp;</li>
  <li><a href="../subscribe.html">Subscribe</a> |&nbsp;</li>
  <li><a href="../developers.html">Developers</a> |&nbsp;</li>
  <li><a href="../cite.html">Cite</a> &nbsp;</li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2008-2015, dipy developers &lt;neuroimaging@python.org&gt;.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>